
<MudGrid Class="mb-1 px-3">
    <MudItem xs="4">
        <MudStack Row="true" Justify="Justify.FlexStart">
            <MudTextField T="string" Placeholder="Filter" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Search" Variant="Variant.Outlined" Style="height:36.5px" @bind-Value="search" />
        </MudStack>
    </MudItem>
    <MudItem xs="4">
        <MudText Typo="Typo.h4" Align="Align.Center" Style="width:100%">
            @PageTab.TabName
        </MudText>
    </MudItem>
    <MudItem xs="4">
        <MudStack Row="true" Justify="Justify.FlexEnd">
            <MudButton Variant="Variant.Filled" Color="Color.Success">New</MudButton>
        </MudStack>
    </MudItem>
</MudGrid>

<MudTabs Elevation="4" Rounded="true" Centered="true" Color="@Color.Primary" Class="tab-bar" />

<MudTable Items="items" Hover="true" Striped="false" Filter="Filter" Height="640px" FixedHeader="true" Class="rounded-0 mx-3">
    <HeaderContent>
        <MudTh>Avatar</MudTh>
        <MudTh>Name</MudTh>
        <MudTh>@IdTitle</MudTh>
        @if (!string.IsNullOrWhiteSpace(AdditionalIdTitle))
        {
            <MudTh>@AdditionalIdTitle</MudTh>
        }
        <MudTh>Actions</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Avatar">@context.AvatarUrl</MudTd>
        <MudTd DataLabel="Name">@context.Name</MudTd>
        <MudTd DataLabel="@IdTitle">@context.Id</MudTd>
        @if (!string.IsNullOrWhiteSpace(AdditionalIdTitle))
        {
            <MudTd DataLabel="@AdditionalIdTitle">@context.AdditionalId</MudTd>
        }
        <MudTd DataLabel="Action">
            <MudIconButton Color="Color.Primary" Icon="@Icons.Material.Filled.Edit" />
            <MudIconButton Color="Color.Error" Icon="@Icons.Material.Filled.Delete" />
        </MudTd>
    </RowTemplate>
</MudTable>
<MudPaper Class="mud-theme-primary d-flex flex-column align-center" Elevation="4" Style="height:48px;">
    <MudStack Justify="Justify.SpaceBetween" Row="true" Style="width:100%">
        <div />
        <MudPagination @ref="mudPaginationRef" @bind-Selected="currentPage" Size="Size.Medium" Count="pages" Color="Color.Info" @bind-Selected:after="Navigate" Style="height:48px;" />
        <div />
    </MudStack>
</MudPaper>

@code {
    [CascadingParameter(Name = "PageTab")]
    public PageTab PageTab { get; set; }

    [Parameter]
    public string IdTitle { get; set; } = "ID";

    [Parameter]
    public string? AdditionalIdTitle { get; set; }

    int currentPage = 1;
    int pages = 1;
    int itemsPerPage = 100;
    MudPagination? mudPaginationRef;

    List<DashboardModel> items = new();
    string search;

    // Temp
    protected override void OnInitialized()
    {
        for (int i = 0; i < 100; i++)
        {
            items.Add(new()
                {
                    AvatarUrl = "#",
                    Id = i,
                    AdditionalId = 100 + i,
                    Name = "Dummy " + i
                });
        }

        base.OnInitialized();
    }

    protected override void OnAfterRender(bool firstRender)
    {
        pages = (int)Math.Ceiling((double)(items.Count / itemsPerPage));
        base.OnAfterRender(firstRender);
    }


    private bool Filter(DashboardModel model)
    {
        if (string.IsNullOrWhiteSpace(search))
            return true;

        if (model.Name?.Contains(search, StringComparison.OrdinalIgnoreCase) ?? false)
            return true;

        if (model.Id.ToString().Contains(search))
            return true;

        if (model.AdditionalId?.ToString().Contains(search) ?? false)
            return true;

        return false;
    }

    void Navigate()
    {

    }
}