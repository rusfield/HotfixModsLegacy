@using HotfixMods.Infrastructure.Blazor.Components.Dialogs;
@using HotfixMods.Infrastructure.Blazor.Pages.CreatureTabs
@using HotfixMods.Infrastructure.Blazor.Components.DtoContent

@inject CreatureService Service
@inject IDialogService DialogService
@inherits PageBase<CreatureDto>

<DtoTabsContent T="CreatureDto" SaveAsync_Func="SaveAsync" ValueCompare_Callback="@(async () => ValueCompareAsync<CreatureSearch_Dialog>())" />


@code {

    // Temp
    protected override void OnParametersSet()
    {
        if (null == PageTab.Dto)
            PageTab.Dto = new CreatureDto();
        base.OnParametersSet();
    }

    async Task<bool> SaveAsync()
    {
        var result = false;
        if (PageTab.Dto != null)
        {
            List<string> logs = new();
            result = await Service.SaveAsync((CreatureDto)PageTab.Dto, (string title, string subtitle, int progress) =>
            {
                logs.Add(subtitle);
            });
            if (!result)
            {
                var parameters = new DialogParameters();
                parameters.Add(nameof(Message_Dialog.Text), string.Join('\n', logs));
                DialogService.Show<Message_Dialog>(null, parameters);
            }
        }
        return result;
    }
}
